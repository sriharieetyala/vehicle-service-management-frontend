<div class="page-container">
    <div class="container">
        <div class="page-header">
            <div>
                <a routerLink="/admin" class="back-link"><i class="bi bi-arrow-left"></i> Back to Dashboard</a>
                <h1>Manage Users</h1>
            </div>
        </div>

        <!-- Role Filter -->
        <div style="margin-bottom:20px">
            <strong>Filter by Role:</strong>
            <select [(ngModel)]="selectedRole" (change)="applyFilter()" style="margin-left:10px;padding:5px">
                <option value="ALL">All Users</option>
                <option value="CUSTOMER">Customers</option>
                <option value="TECHNICIAN">Technicians</option>
                <option value="MANAGER">Managers</option>
            </select>
            <span style="margin-left:20px">Total: {{ filteredUsers.length }}</span>
        </div>

        @if (isLoading) {
        <div class="loading">Loading users...</div>
        } @else if (filteredUsers.length === 0) {
        <div class="empty-state">
            <i class="bi bi-people"></i>
            <p>No users found</p>
        </div>
        } @else {
        <table border="1" cellpadding="10" style="width:100%;border-collapse:collapse">
            <tr style="background:#f0f0f0">
                <th>S.No</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            @for (u of filteredUsers; track u.id; let i = $index) {
            <tr>
                <td>{{ i + 1 }}</td>
                <td>{{ u.firstName }} {{ u.lastName }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.phone || '-' }}</td>
                <td>
                    <span class="role-badge" [class]="getRoleBadgeClass(u.role)">{{ u.role }}</span>
                </td>
                <td>
                    <span class="status-badge" [class]="getStatusClass(u.status)">{{ u.status }}</span>
                </td>
                <td>
                    @if (u.status === 'ACTIVE') {
                    <button type="button" class="btn btn-deactivate" (click)="openDeactivateModal(u)">
                        Deactivate
                    </button>
                    } @else {
                    <span style="color:#999">Deactivated</span>
                    }
                </td>
            </tr>
            }
        </table>
        }
    </div>
</div>

<!-- Deactivate Confirmation Modal -->
@if (showDeactivateModal && userToDeactivate) {
<div class="modal-backdrop" (click)="closeDeactivateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Deactivate User</h3>
            <button class="modal-close" (click)="closeDeactivateModal()"><i class="bi bi-x"></i></button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to deactivate <strong>{{ userToDeactivate.firstName }} {{
                    userToDeactivate.lastName }}</strong> ({{ userToDeactivate.role }})?</p>
            <p class="warning-text">This will prevent them from logging in.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeDeactivateModal()">Cancel</button>
            <button type="button" class="btn btn-danger" (click)="confirmDeactivate()">Yes, Deactivate</button>
        </div>
    </div>
</div>
}