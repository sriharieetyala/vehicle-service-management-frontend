<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" routerLink="/">
            <i class="bi bi-car-front-fill me-2"></i>
            <span class="brand-text">VSMS</span>
        </a>

        <!-- Mobile Hamburger Toggle -->
        <button class="navbar-toggler" type="button" (click)="toggleMobileMenu()">
            <i class="bi" [class.bi-list]="!showMobileMenu" [class.bi-x-lg]="showMobileMenu"></i>
        </button>

        <!-- Nav Content -->
        <div class="navbar-collapse" [class.show]="showMobileMenu">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                @if (showHomeLink) {
                <li class="nav-item">
                    <a class="nav-link" routerLink="/" routerLinkActive="active"
                        [routerLinkActiveOptions]="{exact: true}" (click)="showMobileMenu = false">Home</a>
                </li>
                }
                @if (isLoggedIn) {
                <li class="nav-item">
                    <a class="nav-link dashboard-link" [routerLink]="dashboardLink" routerLinkActive="active"
                        (click)="showMobileMenu = false">Dashboard</a>
                </li>
                }
                @if (showHomeLink) {
                <li class="nav-item">
                    <a class="nav-link" routerLink="/" fragment="services" (click)="showMobileMenu = false">Services</a>
                </li>
                }
                <li class="nav-item">
                    <a class="nav-link" routerLink="/" fragment="about" (click)="showMobileMenu = false">About</a>
                </li>
            </ul>

            <div class="nav-auth">
                @if (isLoggedIn) {
                <!-- Profile Dropdown -->
                <div class="profile-dropdown" (clickOutside)="closeDropdown()">
                    <button class="profile-btn" (click)="toggleDropdown($event)">
                        <i class="bi bi-person-circle"></i>
                        <span>{{ userName }}</span>
                        <i class="bi bi-chevron-down" [class.rotate]="showDropdown"></i>
                    </button>

                    <div class="dropdown-menu" [class.show]="showDropdown">
                        @if (!isAdmin) {
                        <a routerLink="/profile" class="dropdown-item" (click)="closeMenus()">
                            <i class="bi bi-person me-2"></i>Profile
                        </a>
                        }
                        @if (!isAdmin) {
                        <button class="dropdown-item" (click)="openChangePasswordModal()">
                            <i class="bi bi-key me-2"></i>Change Password
                        </button>
                        }
                        @if (isCustomer) {
                        <button class="dropdown-item text-danger" (click)="openDeleteAccountModal()">
                            <i class="bi bi-trash me-2"></i>Delete Account
                        </button>
                        }
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item" (click)="openLogoutModal()">
                            <i class="bi bi-box-arrow-right me-2"></i>Logout
                        </button>
                    </div>
                </div>
                } @else {
                <a routerLink="/auth/login" class="btn btn-outline-primary me-2" (click)="showMobileMenu = false">Sign
                    In</a>
                <a routerLink="/auth/register" class="btn btn-primary" (click)="showMobileMenu = false">Register</a>
                }
            </div>
        </div>
    </div>
</nav>

<!-- Logout Confirmation Modal -->
@if (showLogoutModal) {
<div class="modal-overlay" (click)="showLogoutModal = false">
    <div class="modal-box" (click)="$event.stopPropagation()">
        <p>Are you sure you want to logout?</p>
        <div class="modal-actions">
            <button class="btn btn-cancel" (click)="showLogoutModal = false">No</button>
            <button class="btn btn-confirm" (click)="confirmLogout()">Yes</button>
        </div>
    </div>
</div>
}

<!-- Change Password Modal -->
@if (showChangePasswordModal) {
<div class="modal-overlay" (click)="showChangePasswordModal = false">
    <div class="modal-box modal-form" (click)="$event.stopPropagation()">
        <h3>Change Password</h3>

        @if (passwordError) {
        <div class="alert alert-danger">{{ passwordError }}</div>
        }
        @if (passwordSuccess) {
        <div class="alert alert-success">{{ passwordSuccess }}</div>
        }

        <form [formGroup]="passwordForm" (ngSubmit)="submitChangePassword()">
            <div class="mb-3">
                <label class="form-label">Current Password</label>
                <input type="password" class="form-control" formControlName="currentPassword"
                    placeholder="Current password">
            </div>
            <div class="mb-3">
                <label class="form-label">New Password</label>
                <input type="password" class="form-control" formControlName="newPassword" placeholder="New password">
                <small class="text-muted">Minimum 8 characters</small>
            </div>
            <div class="mb-3">
                <label class="form-label">Confirm Password</label>
                <input type="password" class="form-control" formControlName="confirmPassword"
                    placeholder="Confirm password">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-cancel" (click)="showChangePasswordModal = false">Cancel</button>
                <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || isChangingPassword">
                    @if (isChangingPassword) { Changing... } @else { Change Password }
                </button>
            </div>
        </form>
    </div>
</div>
}

<!-- Delete Account Modal -->
@if (showDeleteAccountModal) {
<div class="modal-overlay" (click)="showDeleteAccountModal = false">
    <div class="modal-box" (click)="$event.stopPropagation()">
        <p>Delete your account? This cannot be undone.</p>
        @if (deleteError) {
        <div class="alert alert-danger">{{ deleteError }}</div>
        }
        <div class="modal-actions">
            <button class="btn btn-cancel" (click)="showDeleteAccountModal = false">No</button>
            <button class="btn btn-confirm btn-danger" (click)="confirmDeleteAccount()" [disabled]="isDeleting">
                {{ isDeleting ? 'Deleting...' : 'Yes, Delete' }}
            </button>
        </div>
    </div>
</div>
}